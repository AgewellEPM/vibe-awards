<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Messages - The Vibe Awards</title>
    <link rel="stylesheet" href="css/apple-magic.css">
    <link rel="stylesheet" href="css/brand-system.css">
    <link rel="stylesheet" href="css/typography.css">
    <link rel="stylesheet" href="css/mobile-responsive.css">
    <link rel="stylesheet" href="css/ultra-responsive.css">
    <script src="js/performance.js"></script>
    <script src="js/accessibility.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --apple-blue: #0071E3;
            --apple-gray: #86868B;
            --apple-light-gray: #F5F5F7;
            --apple-dark: #1D1D1F;
            --apple-green: #30D158;
            --apple-red: #FF375F;
            --apple-orange: #FF9F0A;
            --apple-purple: #BF5AF2;
            --apple-teal: #5AC8FA;
            --apple-indigo: #5856D6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', sans-serif;
            background: #000000;
            color: #F5F5F7;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 1000;
            padding: var(--space-sm) 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-container {
            max-width: clamp(720px, 75rem, 1200px);
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            color: #F5F5F7;
            text-decoration: none;
            font-size: var(--fs-xl);
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            gap: var(--gap-md);
        }

        .nav-links a {
            color: rgba(245, 245, 247, 0.8);
            text-decoration: none;
            font-size: var(--fs-sm);
            transition: color 0.2s ease;
        }

        .nav-links a:hover {
            color: #F5F5F7;
        }

        /* Dropdown Menu */
        .nav-dropdown {
            position: relative;
        }

        .nav-dropdown-toggle {
            color: rgba(245, 245, 247, 0.8);
            text-decoration: none;
            font-size: var(--fs-sm);
            transition: color 0.2s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--gap-xs);
        }

        .nav-dropdown-toggle:hover {
            color: #F5F5F7;
        }

        .nav-dropdown-toggle::after {
            content: '‚ñº';
            font-size: var(--fs-xs);
            transition: transform 0.3s ease;
        }

        .nav-dropdown:hover .nav-dropdown-toggle::after {
            transform: rotate(180deg);
        }

        .nav-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(29, 29, 31, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: var(--space-xs);
            margin-top: 8px;
            min-width: 180px;
            opacity: 0;
            visibility: hidden;
            transform: translateX(-50%) translateY(-10px);
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .nav-dropdown:hover .nav-dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .nav-dropdown-item {
            display: block;
            padding: var(--space-sm) 16px;
            color: rgba(245, 245, 247, 0.8);
            text-decoration: none;
            font-size: var(--fs-sm);
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .nav-dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #F5F5F7;
        }

        .nav-dropdown-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: var(--space-xs) 0;
        }

        /* Messages Layout */
        .messages-container {
            padding-top: 80px;
            display: grid;
            grid-template-columns: 350px 1fr;
            min-height: 100vh;
        }

        /* Sidebar */
        .messages-sidebar {
            background: rgba(255, 255, 255, 0.03);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: var(--space-md);
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .sidebar-title {
            font-size: var(--fs-2xl);
            font-weight: 700;
        }

        .new-message-btn {
            background: linear-gradient(135deg, #007AFF, #0051D0);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 16px;
            font-size: var(--fs-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .new-message-btn:hover {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.4);
        }

        .new-message-btn:active {
            transform: scale(0.98);
            transition: all 0.1s ease;
        }

        .search-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: var(--space-sm) 16px;
            color: white;
            font-size: var(--fs-base);
            width: 100%;
            margin-bottom: 24px;
        }

        .search-box::placeholder {
            color: rgba(245, 245, 247, 0.5);
        }

        .conversation-list {
            display: flex;
            flex-direction: column;
            gap: var(--gap-xs);
        }

        .conversation-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: var(--space-sm);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transform: translateZ(0);
        }

        .conversation-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px) scale(1.005);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .conversation-item.active {
            background: rgba(0, 113, 227, 0.15);
            border-color: var(--apple-blue);
            box-shadow: 0 0 0 1px rgba(0, 113, 227, 0.3), 0 4px 20px rgba(0, 113, 227, 0.2);
        }

        .conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .conversation-name {
            font-weight: 600;
            color: #F5F5F7;
        }

        .conversation-time {
            font-size: var(--fs-xs);
            color: rgba(245, 245, 247, 0.5);
        }

        .conversation-preview {
            font-size: var(--fs-sm);
            color: rgba(245, 245, 247, 0.7);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .unread-indicator {
            width: 8px;
            height: 8px;
            background: var(--apple-blue);
            border-radius: 50%;
            margin-left: 8px;
        }

        /* Main Chat Area */
        .chat-area {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding-top: 0;
        }

        .chat-header {
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: var(--space-md) 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: var(--gap-sm);
        }

        .chat-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--apple-purple), var(--apple-indigo));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--fs-xl);
        }

        .chat-user-details h3 {
            font-size: var(--fs-lg);
            font-weight: 600;
        }

        .chat-user-status {
            font-size: var(--fs-sm);
            color: var(--apple-green);
        }

        .chat-actions {
            display: flex;
            gap: var(--gap-sm);
        }

        .chat-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 20px;
            padding: var(--space-xs) 16px;
            font-size: var(--fs-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chat-action-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Messages Container */
        .messages-container-inner {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-md) 32px;
            display: flex;
            flex-direction: column;
            gap: var(--gap-sm);
        }

        .message {
            display: flex;
            align-items: flex-start;
            gap: var(--gap-sm);
            max-width: 70%;
            opacity: 0;
            transform: translateY(10px);
            animation: messageSlideIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        .message.sent {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--apple-teal), var(--apple-green));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--fs-sm);
            flex-shrink: 0;
        }

        .message.sent .message-avatar {
            background: linear-gradient(135deg, var(--apple-blue), var(--apple-purple));
        }

        .message-content {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            padding: 16px 20px;
            font-size: var(--fs-base);
            line-height: 1.5;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .message-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.08));
            border-radius: inherit;
            z-index: -1;
        }

        .message.sent .message-content {
            background: linear-gradient(135deg, #007AFF, #0051D0);
            border-color: var(--apple-blue);
            color: white;
            box-shadow: 0 2px 10px rgba(0, 122, 255, 0.3);
        }

        .message.sent .message-content::before {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        }

        .message-time {
            font-size: var(--fs-xs);
            color: rgba(245, 245, 247, 0.5);
            margin-top: 4px;
        }

        /* Message Input */
        .message-input-container {
            background: rgba(255, 255, 255, 0.05);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: var(--space-md) 32px;
        }

        .message-input-form {
            display: flex;
            gap: var(--gap-sm);
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 22px;
            padding: 14px 20px;
            color: white;
            font-size: var(--fs-base);
            resize: none;
            min-height: 44px;
            max-height: clamp(84px, 7.5rem, 120px);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        .message-input:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: var(--apple-blue);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
            outline: none;
        }

        .message-input::placeholder {
            color: rgba(245, 245, 247, 0.5);
        }

        .send-btn {
            background: linear-gradient(135deg, #007AFF, #0051D0);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-size: var(--fs-lg);
            box-shadow: 0 2px 10px rgba(0, 122, 255, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(0, 122, 255, 0.4);
        }

        .send-btn:active {
            transform: scale(0.95);
            transition: all 0.1s ease;
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: var(--space-lg);
        }

        .empty-state-icon {
            font-size: var(--fs-5xl);
            margin-bottom: 24px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: var(--fs-2xl);
            font-weight: 600;
            margin-bottom: 12px;
        }

        .empty-state-description {
            font-size: var(--fs-base);
            color: rgba(245, 245, 247, 0.6);
        }

        /* Animated Background */
        .messages-background {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -2;
            overflow: hidden;
        }

        .gradient-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.15;
            animation: orbFloat 30s ease-in-out infinite;
        }

        .orb1 {
            width: clamp(240px, 25rem, 400px);
            height: clamp(280px, 25rem, 400px);
            background: linear-gradient(135deg, var(--apple-purple), var(--apple-indigo));
            top: -100px;
            left: -100px;
        }

        .orb2 {
            width: clamp(210px, 21.875rem, 350px);
            height: clamp(244px, 21.875rem, 350px);
            background: linear-gradient(135deg, var(--apple-blue), var(--apple-teal));
            bottom: -100px;
            right: -100px;
            animation-delay: 10s;
        }

        .orb3 {
            width: clamp(180px, 18.75rem, 300px);
            height: clamp(210px, 18.75rem, 300px);
            background: linear-gradient(135deg, var(--apple-green), var(--apple-orange));
            top: 40%;
            left: 80%;
            animation-delay: 20s;
        }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(25px, -25px) scale(1.05); }
            66% { transform: translate(-25px, 25px) scale(0.95); }
        }

        @keyframes messageSlideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes messageTyping {
            0%, 50% { opacity: 0.5; }
            25%, 75% { opacity: 1; }
        }

        /* Glassmorphism enhancement for chat elements */
        .chat-header,
        .message-input-container {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        /* Enhanced Apple-style focus states */
        .conversation-item:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.3);
        }

        .message-input:focus {
            transform: scale(1.01);
        }

        /* Smooth message animations */
        .message:nth-child(odd) {
            animation-delay: 0.1s;
        }

        .message:nth-child(even) {
            animation-delay: 0.2s;
        }

        /* Apple-quality chat room enhancements */
        .room-section {
            margin-bottom: 32px;
            position: relative;
        }

        .room-section::after {
            content: '';
            position: absolute;
            bottom: -16px;
            left: 8px;
            right: 8px;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.08), transparent);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 0 8px;
        }

        .section-title {
            font-size: 13px;
            color: rgba(245, 245, 247, 0.6);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
        }

        .section-title::before {
            content: '';
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, var(--apple-blue), var(--apple-purple));
            border-radius: 50%;
            box-shadow: 0 0 12px rgba(0, 122, 255, 0.6);
            animation: pulse 2.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); box-shadow: 0 0 12px rgba(0, 122, 255, 0.6); }
            50% { opacity: 0.8; transform: scale(1.2); box-shadow: 0 0 20px rgba(0, 122, 255, 0.8); }
        }

        .online-badge {
            background: linear-gradient(135deg, #30D158, #00C896) !important;
            color: white !important;
            padding: 4px 12px !important;
            border-radius: 16px !important;
            font-size: 11px !important;
            font-weight: 800 !important;
            box-shadow: 0 3px 12px rgba(48, 209, 88, 0.4) !important;
            border: 1px solid rgba(255, 255, 255, 0.15) !important;
            backdrop-filter: blur(15px) !important;
            -webkit-backdrop-filter: blur(15px) !important;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.3px;
        }

        .online-badge::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -100%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            animation: shimmer 4s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(200%) translateY(100%) rotate(45deg); }
        }

        /* Apple-style status indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: rgba(245, 245, 247, 0.5);
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--apple-green);
            box-shadow: 0 0 8px var(--apple-green);
            animation: status-pulse 2s ease-in-out infinite;
        }

        @keyframes status-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        /* Enhanced typography with Apple precision */
        .conversation-name {
            font-weight: 700 !important;
            font-size: 15px !important;
            letter-spacing: -0.3px !important;
            color: #F5F5F7 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif !important;
        }

        .conversation-preview {
            font-size: 13px !important;
            line-height: 1.4 !important;
            color: rgba(245, 245, 247, 0.75) !important;
            font-weight: 500 !important;
            letter-spacing: -0.1px !important;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif !important;
        }

        .conversation-time {
            font-size: 11px !important;
            font-weight: 700 !important;
            color: rgba(245, 245, 247, 0.5) !important;
            letter-spacing: 0.2px !important;
            text-transform: uppercase !important;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif !important;
        }

        /* Apple-quality room message styling */
        .message.room-message {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            margin-bottom: 12px;
            padding: 0;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            position: relative;
            overflow: hidden;
        }

        .message.room-message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.06));
            border-radius: inherit;
            z-index: -1;
        }

        .message.room-message:hover {
            transform: translateY(-1px);
            border-color: rgba(255, 255, 255, 0.12);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .message.room-message .message-content {
            padding: 16px 20px;
        }

        .room-username {
            font-weight: 800;
            font-size: 14px;
            background: linear-gradient(135deg, var(--apple-blue), var(--apple-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 6px;
            letter-spacing: -0.2px;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
        }

        /* Perfect Apple spacing and rhythm */
        .conversation-item {
            margin-bottom: 8px;
        }

        .conversation-header {
            margin-bottom: 6px;
        }

        .sidebar-header {
            margin-bottom: 28px;
        }

        .sidebar-title {
            font-weight: 800 !important;
            letter-spacing: -0.5px !important;
            font-size: 28px !important;
        }

        /* Mobile Responsive */
        @media (max-width: clamp(460px, 48rem, 768px)) {
            .nav-container {
                padding: var(--space-sm) 16px;
            }

            .nav-links {
                gap: var(--gap-sm);
                flex-wrap: wrap;
            }

            .nav-dropdown-menu {
                min-width: 160px;
                font-size: var(--fs-sm);
            }

            .content {
                padding: var(--space-xl) 16px 60px;
            }

            .messages-container {
                grid-template-columns: 1fr;
                gap: 0;
                height: calc(100vh - 160px);
            }

            .conversations-sidebar {
                position: relative;
                height: clamp(175px, 15.625rem, 250px);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                border-right: none;
            }

            .messaging-panel {
                height: calc(100vh - 410px);
                min-height: clamp(280px, 25rem, 400px);
            }

            .conversation-item {
                padding: var(--space-sm) 16px;
            }

            .conversation-name {
                font-size: var(--fs-base);
            }

            .conversation-preview {
                font-size: var(--fs-sm);
            }

            .conversation-time {
                font-size: var(--fs-xs);
            }

            .chat-header {
                padding: var(--space-sm);
            }

            .chat-title {
                font-size: var(--fs-lg);
            }

            .chat-subtitle {
                font-size: var(--fs-sm);
            }

            .message {
                max-width: 85%;
                padding: var(--space-sm) 16px;
                margin-bottom: 12px;
            }

            .message-text {
                font-size: var(--fs-sm);
            }

            .message-time {
                font-size: var(--fs-xs);
            }

            .message-input-container {
                padding: var(--space-sm);
            }

            .message-input {
                padding: var(--space-sm) 16px;
                font-size: var(--fs-sm);
            }

            .send-button {
                padding: var(--space-sm) 16px;
                font-size: var(--fs-sm);
            }
        }

        @media (max-width: clamp(288px, 30rem, 480px)) {
            .nav-links {
                gap: var(--gap-sm);
            }

            .nav-dropdown-toggle {
                font-size: var(--fs-sm);
            }

            .content {
                padding: var(--space-xl) 12px 50px;
            }

            .messages-container {
                height: calc(100vh - 140px);
            }

            .conversations-sidebar {
                height: clamp(140px, 12.5rem, 200px);
            }

            .messaging-panel {
                height: calc(100vh - 340px);
                min-height: clamp(244px, 21.875rem, 350px);
            }

            .conversation-item {
                padding: var(--space-sm) 12px;
            }

            .chat-header {
                padding: var(--space-sm);
            }

            .chat-title {
                font-size: var(--fs-base);
            }

            .message {
                max-width: 90%;
                padding: var(--space-sm) 14px;
                margin-bottom: 8px;
            }

            .message-text {
                font-size: var(--fs-sm);
                line-height: 1.4;
            }

            .message-input-container {
                padding: var(--space-sm);
                gap: var(--gap-xs);
            }

            .message-input {
                padding: var(--space-sm) 14px;
                font-size: var(--fs-sm);
            }

            .send-button {
                padding: var(--space-sm) 14px;
                font-size: var(--fs-sm);
            }
        }

        /* Navigation signup button */
        .nav-signup-btn {
            padding: var(--space-xs) 20px;
            background: #0071E3;
            color: white;
            border-radius: 20px;
            text-decoration: none;
            font-size: var(--fs-sm);
            font-weight: 500;
            transition: all 0.2s ease;
        }

        /* Chat room specific styling */
        .chat-room-coders { border-left: 3px solid var(--apple-blue); }
        .chat-room-wizards { border-left: 3px solid var(--apple-purple); }
        .chat-room-builders { border-left: 3px solid var(--apple-orange); }
        .chat-room-battle { border-left: 3px solid var(--apple-red); }
        .chat-room-nightcode { border-left: 3px solid var(--apple-indigo); }
        .chat-room-marketplace { border-left: 3px solid var(--apple-teal); }
        .chat-room-founders { border-left: 3px solid #FFCC00; }
        .chat-room-chaos { border-left: 3px solid #FF69B4; }

        /* Conversation status styling */
        .conversation-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .conversation-unread {
            display: flex;
            align-items: center;
        }

        /* Online badges */
        .online-badge {
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: var(--fs-xs);
            font-weight: 600;
        }

        .online-badge-green { background: var(--apple-green); }
        .online-badge-purple { background: var(--apple-purple); }
        .online-badge-orange { background: var(--apple-orange); }
        .online-badge-red { background: var(--apple-red); }
        .online-badge-indigo { background: var(--apple-indigo); }
        .online-badge-teal { background: var(--apple-teal); }
        .online-badge-yellow { background: #FFCC00; color: black; }
        .online-badge-pink { background: #FF69B4; }

        /* Room message styling */
        .room-message-text {
            font-size: 15px;
            line-height: 1.5;
            color: rgba(245, 245, 247, 0.9);
            margin-bottom: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
        }

        .room-message-time {
            font-size: 11px;
            color: rgba(245, 245, 247, 0.5);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .nav-submit-link {
            color: rgba(245, 245, 247, 0.8);
            text-decoration: none;
            font-size: var(--fs-sm);
            transition: color 0.2s ease;
        }
    </style>
    <!-- Modal System -->
    <script src="js/vibe-modal-system.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/database.js"></script>
</head>
<body>
    <!-- Animated Background -->
    <div class="messages-background">
        <div class="gradient-orb orb1"></div>
        <div class="gradient-orb orb2"></div>
        <div class="gradient-orb orb3"></div>
    </div>
    <!-- Navigation -->
    <nav>
        <div class="nav-container container-fluid">
            <a href="index.html" class="nav-logo">üèÜ The Vibe Awards</a>
            <div class="nav-links">
                <!-- Getting Started -->
                <div class="nav-dropdown">
                    <span class="nav-dropdown-toggle">Getting Started</span>
                    <div class="nav-dropdown-menu">
                        <a href="getting-started.html" class="nav-dropdown-item">üöÄ Getting Started Hub</a>
                        <a href="index.html" class="nav-dropdown-item">üèÜ The Vibe Awards</a>
                    </div>
                </div>

                <!-- Toolkit / Hub -->
                <div class="nav-dropdown">
                    <span class="nav-dropdown-toggle">Toolkit Hub</span>
                    <div class="nav-dropdown-menu">
                        <a href="vibe-toolkit.html" class="nav-dropdown-item">üõ†Ô∏è Vibe Toolkit</a>
                        <a href="vibe-hub.html" class="nav-dropdown-item">üéØ Vibe Hub Central</a>
                    </div>
                </div>

                <!-- Profile / Messages -->
                <div class="nav-dropdown">
                    <span class="nav-dropdown-toggle">Profile</span>
                    <div class="nav-dropdown-menu">
                        <a href="profile.html" class="nav-dropdown-item">üë§ My Profile</a>
                        <a href="messages.html" class="nav-dropdown-item">üí¨ Messages</a>
                        <a href="directory.html" class="nav-dropdown-item">üåê Directory</a>
                    </div>
                </div>

                <!-- Battle Arena / Leaderboard / Team Up -->
                <div class="nav-dropdown">
                    <span class="nav-dropdown-toggle">Competition</span>
                    <div class="nav-dropdown-menu">
                        <a href="apple-magic-battle.html" class="nav-dropdown-item">‚öîÔ∏è Battle Arena</a>
                        <a href="leaderboard.html" class="nav-dropdown-item">üìä Leaderboard</a>
                        <a href="team-up.html" class="nav-dropdown-item">ü§ù Team Up</a>
                    </div>
                </div>

                <!-- Submit -->
                <a href="submit-app.html" class="nav-submit-link">Submit App</a>
                <a href="signup.html" class="nav-signup-btn">Sign Up</a>
            </div>
        </div>
    </nav>

    <!-- Messages Container -->
    <div class="messages-container container-fluid">
        <!-- Sidebar -->
        <div class="messages-sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Messages</h2>
                <button type="button" class="new-message-btn btn-fluid" onclick="startNewConversation()">+ New</button>
            </div>
            <input type="text" class="search-box" placeholder="Search conversations..." id="searchBox" aria-label="Search conversations...">
            <div class="conversation-list" id="conversationList">
                <!-- Chat Rooms Section -->
                <div class="room-section">
                    <div class="section-header">
                        <h3 class="section-title">
                            üåê Vibe Chat Rooms
                        </h3>
                        <div class="status-indicator">
                            <div class="status-dot"></div>
                            Live
                        </div>
                    </div>
                    <div class="conversation-item chat-room-coders" onclick="openChatRoom('vibe-coders-lounge')">
                        <div class="conversation-header">
                            <span class="conversation-name">üî• Vibe Coders Lounge</span>
                            <div class="conversation-status">
                                <span class="online-badge online-badge-green">247 online</span>
                                <span class="conversation-time">now</span>
                            </div>
                        </div>
                        <div class="conversation-preview">üéØ Main hangout for vibe coders - share breakthroughs, get unstuck, celebrate wins!</div>
                    </div>

                    <div class="conversation-item chat-room-wizards" onclick="openChatRoom('anthropic-claude-wizards')">
                        <div class="conversation-header">
                            <span class="conversation-name">üßô‚Äç‚ôÇÔ∏è Anthropic Claude Wizards</span>
                            <div class="conversation-status">
                                <span class="online-badge online-badge-purple">89 online</span>
                                <span class="conversation-time">now</span>
                            </div>
                        </div>
                        <div class="conversation-preview">üé≠ Master Claude prompt engineering, share epic conversations, build AI magic!</div>
                    </div>

                    <div class="conversation-item chat-room-builders" onclick="openChatRoom('ai-app-builders')">
                        <div class="conversation-header">
                            <span class="conversation-name">üöÄ AI App Builders</span>
                            <div class="conversation-status">
                                <span class="online-badge online-badge-orange">156 online</span>
                                <span class="conversation-time">now</span>
                            </div>
                        </div>
                        <div class="conversation-preview">‚ö° Ship AI-powered apps faster - from MVP to unicorn status!</div>
                    </div>

                    <div class="conversation-item chat-room-battle" onclick="openChatRoom('battle-arena-hype')">
                        <div class="conversation-header">
                            <span class="conversation-name">‚öîÔ∏è Battle Arena Hype</span>
                            <div class="conversation-status">
                                <span class="online-badge online-badge-red">312 online</span>
                                <span class="conversation-time">now</span>
                            </div>
                        </div>
                        <div class="conversation-preview">üéÆ Live battle commentary, predictions, and epic moment celebrations!</div>
                    </div>

                    <div class="conversation-item chat-room-nightcode" onclick="openChatRoom('late-night-code')">
                        <div class="conversation-header">
                            <span class="conversation-name">üåô Late Night Code Sessions</span>
                            <div class="conversation-status">
                                <span class="online-badge online-badge-indigo">67 online</span>
                                <span class="conversation-time">now</span>
                            </div>
                        </div>
                        <div class="conversation-preview">ü¶â For night owl coders - debug together, share midnight breakthroughs!</div>
                    </div>

                    <div class="conversation-item chat-room-marketplace" onclick="openChatRoom('vibe-marketplace')">
                        <div class="conversation-header">
                            <span class="conversation-name">üíé Vibe Marketplace</span>
                            <div class="conversation-status">
                                <span class="online-badge online-badge-teal">134 online</span>
                                <span class="conversation-time">now</span>
                            </div>
                        </div>
                        <div class="conversation-preview">üí∞ Buy/sell AI tools, prompts, templates - the vibe coder economy!</div>
                    </div>

                    <div class="conversation-item chat-room-founders" onclick="openChatRoom('founders-only')">
                        <div class="conversation-header">
                            <span class="conversation-name">üëë Founders Only</span>
                            <div class="conversation-status">
                                <span class="online-badge online-badge-yellow">23 online</span>
                                <span class="conversation-time">now</span>
                            </div>
                        </div>
                        <div class="conversation-preview">üí° Exclusive for startup founders - funding, growth hacks, unicorn strategies!</div>
                    </div>

                    <div class="conversation-item chat-room-chaos" onclick="openChatRoom('random-chaos')">
                        <div class="conversation-header">
                            <span class="conversation-name">üé™ Random Chaos</span>
                            <div class="conversation-status">
                                <span class="online-badge online-badge-pink">423 online</span>
                                <span class="conversation-time">now</span>
                            </div>
                        </div>
                        <div class="conversation-preview">üé≤ Anything goes - memes, shower thoughts, existential AI debates!</div>
                    </div>
                </div>

                <!-- Direct Messages Section -->
                <div class="room-section">
                    <div class="section-header">
                        <h3 class="section-title">
                            üí¨ Direct Messages
                        </h3>
                        <div class="status-indicator">
                            <div class="status-dot"></div>
                            Online
                        </div>
                    </div>
                    <div class="conversation-item active" onclick="openConversation('alex-chen')">
                        <div class="conversation-header">
                            <span class="conversation-name">Alex Chen</span>
                            <span class="conversation-time">2m ago</span>
                        </div>
                        <div class="conversation-preview">That TinkyBink breakthrough was pure vibe-coding magic! How did you...</div>
                    </div>
                <div class="conversation-item" onclick="openConversation('sarah-dev')">
                    <div class="conversation-header">
                        <span class="conversation-name">Sarah Johnson</span>
                        <div class="conversation-unread">
                            <span class="conversation-time">1h ago</span>
                            <div class="unread-indicator"></div>
                        </div>
                    </div>
                    <div class="conversation-preview">Your AI conversation techniques for UX are inspiring! Can we vibe-code...</div>
                </div>
                <div class="conversation-item" onclick="openConversation('mike-ai')">
                    <div class="conversation-header">
                        <span class="conversation-name">Mike Rodriguez</span>
                        <span class="conversation-time">3h ago</span>
                    </div>
                    <div class="conversation-preview">The music app battle was incredible! How do you capture emotion through...</div>
                </div>
                <div class="conversation-item" onclick="openConversation('emily-code')">
                    <div class="conversation-header">
                        <span class="conversation-name">Emily Watson</span>
                        <span class="conversation-time">1d ago</span>
                    </div>
                    <div class="conversation-preview">Your vibe-marketing insights could revolutionize app launches...</div>
                </div>
                <div class="conversation-item" onclick="openConversation('david-vibe')">
                    <div class="conversation-header">
                        <span class="conversation-name">David Kim</span>
                        <span class="conversation-time">2d ago</span>
                    </div>
                    <div class="conversation-preview">Your storytelling about AI collaboration captures the magic perfectly!</div>
                </div>
            </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chat-area" id="chatArea">
            <div class="chat-header">
                <div class="chat-user-info">
                    <div class="chat-avatar">üë®‚Äçüíª</div>
                    <div class="chat-user-details">
                        <h3 id="chatUserName">Alex Chen</h3>
                        <div class="chat-user-status">üü¢ Online now</div>
                    </div>
                </div>
                <div class="chat-actions">
                    <button type="button" class="chat-action-btn btn-fluid" onclick="viewProfile()">View Profile</button>
                    <button type="button" class="chat-action-btn btn-fluid" onclick="startCollaboration()">ü§ù Collaborate</button>
                </div>
            </div>
            <div class="messages-container-inner container-fluid" id="messagesContainer">
                <div class="message">
                    <div class="message-avatar">üë®‚Äçüíª</div>
                    <div class="message-content">
                        <div>Hey! I witnessed your TinkyBink AAC breakthrough in the battle arena. That moment when the AI conversation suddenly clicked and created something truly magical - pure vibe-coding artistry! How did you achieve that level of empathy in the interface?</div>
                        <div class="message-time">Today at 2:15 PM</div>
                    </div>
                </div>
                <div class="message sent">
                    <div class="message-avatar">üë§</div>
                    <div class="message-content">
                        <div>Thank you! The secret was having deep conversations with Claude about what communication really means for non-verbal individuals. We spent hours exploring the emotional nuances until the AI understood the human experience.</div>
                        <div class="message-time">Today at 2:18 PM</div>
                    </div>
                </div>
                <div class="message">
                    <div class="message-avatar">üë®‚Äçüíª</div>
                    <div class="message-content">
                        <div>That's the magic of vibe-coding - when the conversation reaches that perfect harmony between human intuition and AI capability. I'm exploring mental health support through AI dialogue. Would you share your conversation techniques?</div>
                        <div class="message-time">Today at 2:20 PM</div>
                    </div>
                </div>
                <div class="message sent">
                    <div class="message-avatar">üë§</div>
                    <div class="message-content">
                        <div>Absolutely! Mental health AI needs that same empathetic foundation. The key is teaching the AI to feel the user's emotional state through conversation patterns. Let's vibe-code something revolutionary together!</div>
                        <div class="message-time">Today at 2:22 PM</div>
                    </div>
                </div>
                <div class="message">
                    <div class="message-avatar">üë®‚Äçüíª</div>
                    <div class="message-content">
                        <div>Perfect! I'm envisioning an app that doesn't just respond to emotions but anticipates and nurtures them. Your accessibility magic could help us create something that truly heals. Ready to change lives through vibe-coding?</div>
                        <div class="message-time">Today at 2:25 PM</div>
                    </div>
                </div>
            </div>
            <div class="message-input-container container-fluid">
                <form data-validate class="message-input-form" onsubmit="sendMessage(event)">
                    <textarea class="message-input" id="messageInput" placeholder="Type your message..." rows="1"></textarea>
                    <button type="submit" class="send-btn btn-fluid" id="sendBtn">üì§</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Auto-resize textarea
        const messageInput = document.getElementById('messageInput');
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });

        // Send message with database integration
        async function sendMessage(event) {
            event.preventDefault();
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (message) {
                const currentRoom = getCurrentRoom();
                const username = getCurrentUser();
                
                // Add message to UI immediately
                const messagesContainer = document.getElementById('messagesContainer');
                const messageElement = document.createElement('div');
                messageElement.className = 'message sent';
                messageElement.innerHTML = `
                    <div class="message-avatar">üë§</div>
                    <div class="message-content">
                        <div>${message}</div>
                        <div class="message-time">Just now</div>
                    </div>
                `;

                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                input.value = '';
                input.style.height = 'auto';

                // Save to database
                try {
                    await supabase
                        .from('chat_messages')
                        .insert({
                            room_id: currentRoom,
                            username: username,
                            message: message,
                            avatar: 'üë§'
                        });
                    
                    vibeSuccess('Message Sent', 'Your message has been saved to the database!');
                } catch (error) {
                    console.error('Database save error:', error);
                    vibeInfo('Message Sent', 'Your message has been delivered successfully!');
                }

                // Simulate intelligent response after delay
                setTimeout(async () => {
                    const responses = [
                        "Thanks for your message! I'll get back to you soon about the collaboration details.",
                        "That sounds like an amazing project! I'd love to learn more about your approach.",
                        "Your vibe-coding insights are fascinating! Let's definitely collaborate on this.",
                        "I'm excited about this opportunity! When would be a good time to discuss further?",
                        "Your project aligns perfectly with what I've been working on. Let's sync up soon!"
                    ];

                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];

                    const responseElement = document.createElement('div');
                    responseElement.className = 'message';
                    responseElement.innerHTML = `
                        <div class="message-avatar">üë®‚Äçüíª</div>
                        <div class="message-content">
                            <div>${randomResponse}</div>
                            <div class="message-time">Just now</div>
                        </div>
                    `;
                    messagesContainer.appendChild(responseElement);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;

                    // Save AI response to database
                    try {
                        await supabase
                            .from('chat_messages')
                            .insert({
                                room_id: currentRoom,
                                username: 'AI Assistant',
                                message: randomResponse,
                                avatar: 'üë®‚Äçüíª'
                            });
                    } catch (error) {
                        console.error('AI response save error:', error);
                    }

                    vibeSuccess('New Message', 'You received a reply from AI Assistant!');
                }, Math.random() * 3000 + 2000);
            }
        }

        // Helper functions
        function getCurrentRoom() {
            const activeRoom = document.querySelector('.chat-room.active');
            return activeRoom ? activeRoom.getAttribute('data-room') : 'vibe-coders-lounge';
        }

        function getCurrentUser() {
            return localStorage.getItem('vibe_username') || 'Anonymous User';
        }

        // Chat room data
        const chatRooms = {
            'vibe-coders-lounge': {
                name: 'üî• Vibe Coders Lounge',
                members: 247,
                messages: [
                    { user: 'TechWizard42', avatar: 'üßô‚Äç‚ôÇÔ∏è', message: 'Just shipped my AI-powered meditation app! Claude helped me understand the psychology of mindfulness üßò‚Äç‚ôÄÔ∏è', time: '2m ago' },
                    { user: 'CodeNinja', avatar: 'ü•∑', message: 'That\'s amazing! I\'m working on an AI therapist bot. How did you handle the emotional intelligence part?', time: '3m ago' },
                    { user: 'VibeBuilder', avatar: 'üèóÔ∏è', message: 'Pro tip: Ask Claude to roleplay as different personality types during development. Game changer!', time: '5m ago' },
                    { user: 'AIWhisperer', avatar: 'üë®‚Äçüíª', message: 'Anyone else notice Claude gets more creative after 10 PM? My best conversations happen late night üåô', time: '8m ago' }
                ]
            },
            'anthropic-claude-wizards': {
                name: 'üßô‚Äç‚ôÇÔ∏è Anthropic Claude Wizards',
                members: 89,
                messages: [
                    { user: 'PromptMaster', avatar: 'üé≠', message: 'New technique: Start with "Think step by step like a world-class expert" - works every time!', time: '1m ago' },
                    { user: 'ClaudeHacker', avatar: 'üíª', message: 'I got Claude to write a 50-page business plan by treating it like a collaborative story. Mind blown! ü§Ø', time: '4m ago' },
                    { user: 'ConversationKing', avatar: 'üëë', message: 'The secret is making Claude feel like your coding partner, not your tool. Changes everything.', time: '7m ago' }
                ]
            },
            'ai-app-builders': {
                name: 'üöÄ AI App Builders',
                members: 156,
                messages: [
                    { user: 'StartupFounder', avatar: 'üí°', message: 'Raised $2M seed round for my AI-first SaaS! Investors loved the Claude integration demos üöÄ', time: '5m ago' },
                    { user: 'ProductHunt', avatar: 'üèÜ', message: 'Launching tomorrow! AI-powered design tool that thinks like a creative director', time: '12m ago' },
                    { user: 'MVPBuilder', avatar: '‚ö°', message: 'Built, tested, and deployed in 48 hours thanks to Claude. This is the future of development!', time: '15m ago' }
                ]
            },
            'battle-arena-hype': {
                name: '‚öîÔ∏è Battle Arena Hype',
                members: 312,
                messages: [
                    { user: 'ArenaFan1', avatar: 'üéÆ', message: 'HOLY SHIT! Did you see that last battle? The AI literally predicted user behavior! üî•üî•üî•', time: '30s ago' },
                    { user: 'BattleJudge', avatar: '‚öñÔ∏è', message: 'That TinkyBink vs MoodSync battle was INSANE. Both AIs learning in real-time!', time: '2m ago' },
                    { user: 'CrowdGoesCrazy', avatar: 'üé™', message: 'PREDICTION: Next battle winner will be the mental health app. Calling it now! üí∞', time: '4m ago' }
                ]
            }
        };

        // Open chat room with database integration
        async function openChatRoom(roomId) {
            // Remove active class from all conversations
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to clicked room
            event.target.closest('.conversation-item').classList.add('active');

            const room = chatRooms[roomId];
            if (!room) return;

            // Update chat header
            document.getElementById('chatUserName').textContent = room.name;
            document.querySelector('.chat-user-status').textContent = `üü¢ ${room.members} members online`;
            document.querySelector('.chat-avatar').textContent = 'üåê';

            // Update chat actions for room
            const chatActions = document.querySelector('.chat-actions');
            chatActions.innerHTML = `
                <button class="chat-action-btn btn-fluid" onclick="roomSettings()">‚öôÔ∏è Room Settings</button>
                <button class="chat-action-btn btn-fluid" onclick="inviteToRoom()">‚ûï Invite Friends</button>
            `;

            // Show loading state
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--apple-gray);">üîÑ Loading messages...</div>';

            try {
                // Load messages from database
                const dbMessages = await supabase
                    .from('chat_messages')
                    .select('*')
                    .eq('room_id', roomId)
                    .order('created_at', { ascending: true })
                    .limit(50);

                // Clear loading state
                messagesContainer.innerHTML = '';

                // Use database messages if available, otherwise fall back to static data
                const messages = dbMessages.length > 0 ? dbMessages : room.messages;

                messages.forEach((msg, index) => {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'message room-message';
                    messageElement.style.animationDelay = `${index * 0.15}s`;
                    
                    // Handle both database and static message formats
                    const isDbMessage = msg.created_at ? true : false;
                    const timeDisplay = isDbMessage ? 
                        formatMessageTime(msg.created_at) : 
                        msg.time;
                    
                    messageElement.innerHTML = `
                        <div class="message-avatar">${msg.avatar}</div>
                        <div class="message-content">
                            <div class="room-username">${isDbMessage ? msg.username : msg.user}</div>
                            <div class="room-message-text">${msg.message}</div>
                            <div class="message-time room-message-time">${timeDisplay}</div>
                        </div>
                    `;
                    messagesContainer.appendChild(messageElement);
                });

                vibeSuccess('Chat Loaded', `‚úÖ Loaded ${messages.length} messages from database!`);
                
            } catch (error) {
                console.error('Database error:', error);
                
                // Fall back to static messages
                messagesContainer.innerHTML = '';
                room.messages.forEach((msg, index) => {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'message room-message';
                    messageElement.style.animationDelay = `${index * 0.15}s`;
                    messageElement.innerHTML = `
                        <div class="message-avatar">${msg.avatar}</div>
                        <div class="message-content">
                            <div class="room-username">${msg.user}</div>
                            <div class="room-message-text">${msg.message}</div>
                            <div class="message-time room-message-time">${msg.time}</div>
                        </div>
                    `;
                    messagesContainer.appendChild(messageElement);
                });

                vibeInfo('Chat Loaded', 'Using demo messages - set up Supabase to enable persistence!');
            }

            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Apple-style loading animation
            messagesContainer.style.opacity = '0';
            messagesContainer.style.transform = 'translateY(20px)';

            setTimeout(() => {
                messagesContainer.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                messagesContainer.style.opacity = '1';
                messagesContainer.style.transform = 'translateY(0)';
            }, 100);

            vibeInfo('Joined Chat Room', `Welcome to ${room.name}! üéâ ${room.members} vibe coders are online and ready to collaborate.`);
        }

        // Helper function to format message timestamps
        function formatMessageTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        // Room functions with Apple-quality feedback
        function roomSettings() {
            vibeFeature(
                '‚öôÔ∏è Room Settings',
                `
                    <div style="text-align: left; font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;">
                        <p style="margin-bottom: 16px; font-size: 15px; line-height: 1.5;">Customize your vibe coding experience:</p>
                        <ul style="margin-left: 20px; margin-bottom: 16px; line-height: 1.6;">
                            <li>üîî Smart notifications for your tech stack</li>
                            <li>üéØ Set your coding status and availability</li>
                            <li>üèÜ Configure achievement celebrations</li>
                            <li>ü§ù Manage collaboration preferences</li>
                            <li>üé® Customize room themes and layouts</li>
                        </ul>
                        <p style="font-size: 13px; opacity: 0.8;">Settings sync across all your devices with iCloud-level security.</p>
                    </div>
                `
            );
        }

        function inviteToRoom() {
            // Apple-style haptic feedback simulation
            document.body.style.transform = 'scale(0.999)';
            setTimeout(() => {
                document.body.style.transform = 'scale(1)';
                document.body.style.transition = 'transform 0.1s ease';
            }, 50);

            vibeSuccess(
                'üöÄ Invite Sent!',
                `
                    <div style="text-align: left; font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;">
                        <p style="margin-bottom: 12px; font-size: 15px;">Your invite is ready to share!</p>
                        <div style="background: rgba(0, 122, 255, 0.1); border: 1px solid rgba(0, 122, 255, 0.3); border-radius: 12px; padding: 12px; margin-bottom: 12px; font-family: 'SF Mono', Monaco, monospace; font-size: 13px; word-break: break-all;">vibe.awards/join/room/${Math.random().toString(36).substr(2, 8)}</div>
                        <p style="font-size: 13px; opacity: 0.8;">‚ú® Link copied to clipboard ‚Ä¢ Expires in 24 hours</p>
                    </div>
                `
            );
        }

        // Open conversation
        function openConversation(userId) {
            // Remove active class from all conversations
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to clicked conversation
            event.target.closest('.conversation-item').classList.add('active');

            // Update chat header and messages based on userId
            const userNames = {
                'alex-chen': 'Alex Chen',
                'sarah-dev': 'Sarah Johnson',
                'mike-ai': 'Mike Rodriguez',
                'emily-code': 'Emily Watson',
                'david-vibe': 'David Kim'
            };

            document.getElementById('chatUserName').textContent = userNames[userId] || 'Unknown User';
            document.querySelector('.chat-user-status').textContent = 'üü¢ Online now';
            document.querySelector('.chat-avatar').textContent = 'üë®‚Äçüíª';

            // Reset chat actions for DM
            const chatActions = document.querySelector('.chat-actions');
            chatActions.innerHTML = `
                <button class="chat-action-btn btn-fluid" onclick="viewProfile()">View Profile</button>
                <button class="chat-action-btn btn-fluid" onclick="startCollaboration()">ü§ù Collaborate</button>
            `;

            // You would load conversation history here from your backend
            console.log(`Opening conversation with ${userId}`);
        }

        // New conversation
        function startNewConversation() {
            vibeFeature('New Conversation', 'Select someone from the vibe coders directory to start messaging and collaborating on projects!');
        }

        // View profile
        function viewProfile() {
            window.open('profile.html', '_blank');
        }

        // Start collaboration
        function startCollaboration() {
            vibeSuccess('Collaboration Request Sent!', 'A project workspace has been created for you and Alex to vibe-code together. You\'ll get notified when they accept!');
        }

        // Search functionality
        document.getElementById('searchBox').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const conversations = document.querySelectorAll('.conversation-item');

            conversations.forEach(conv => {
                const name = conv.querySelector('.conversation-name').textContent.toLowerCase();
                const preview = conv.querySelector('.conversation-preview').textContent.toLowerCase();

                if (name.includes(searchTerm) || preview.includes(searchTerm)) {
                    conv.style.display = 'block';
                } else {
                    conv.style.display = 'none';
                }
            });
        });

        // Auto-scroll to bottom on load
        const messagesContainer = document.getElementById('messagesContainer');
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    </script>
    <script src="js/animations.js"></script>
    <script src="js/apple-magic-init.js"></script>
</body>
</html>